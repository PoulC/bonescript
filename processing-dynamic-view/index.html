<html>
<head>
<title>Beaglebone + BMP085 sensorboard Processing.js + socket.io demo</title>
</head>
<body>
<h1>Processing.js + socket.io demo</h1>
<canvas id="canvas1"></canvas>
<pre>
<span id="output"><!--%OUTPUT%--></span>
</pre>

<h2>Status:</h2>
<p><span id="status">Not yet connected</span></p>


<script src="/socket.io/socket.io.js"></script>
<script src="processing.js"></script>
<script type="text/javascript">
var pressure = 1;
var PI = 3.14;
var HALF_PI = 1.57;
var TWO_PI = 6.28;
var unit = "jiggoWatt";

var sketchProc = function(p) {
 p.size(400, 400);

 p.draw = function() {
  p.background(255);
  p.fill(220);
  p.noStroke();
  // Angles for sin() and cos() start at 3 o'clock;
  // subtract HALF_PI to make them start at the top
  p.ellipse(200, 200, 320, 320);

   var angle = -HALF_PI + HALF_PI / 3;
   var inc = TWO_PI / 12;
   p.stroke(100);
   p.strokeWeight(4);
   p.arc(200, 200, 320, 320, -(4/3)*PI, PI/3);

   for ( i = 1; i <= 12; i++, angle += inc ) {
       if(i!=6) p.line(200 + Math.cos(angle) * 140,200 + Math.sin(angle) * 140,200 + Math.cos(angle) * 160,200 + Math.sin(angle) * 160);
   }
  
  p.stroke(100);
  p.strokeWeight(6);
  p.line(200, 200, Math.cos(pressure) * 140 + 200, Math.sin(pressure) * 140 + 200);
 };

 p.noLoop();
}

var canvas = document.getElementById("canvas1");
var processing = new Processing(canvas, sketchProc);

var socket = new io.connect();
socket.on('connect', function() {
 document.getElementById("status").innerHTML="Connected";
});

socket.on('data', function(data) {
 document.getElementById("output").innerHTML="" + data + " " + unit;
 var myData = parseFloat(data);
 // Angles for sin() and cos() start at 3 o'clock;
 // subtract HALF_PI to make them start at the top
 pressure = myData * (6.28 / 1000) - 1.57;

 processing.redraw();
});

socket.on('pressureconfig', function(config) {
 try {
  unit = config.unit;
 } catch(ex) {}
});

socket.on('disconnect', function() {
 document.getElementById("status").innerHTML="Disconnected";
 p.exit();
});

</script>
</body>
</html>
